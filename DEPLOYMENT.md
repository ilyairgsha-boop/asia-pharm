# üöÄ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é Asia Pharm –Ω–∞ Vercel + Supabase

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç Supabase, –Ω–∞—á–Ω–∏—Ç–µ —Å —Ä–∞–∑–¥–µ–ª–∞ [#6 –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#6-–æ—á–∏—Å—Ç–∫–∞-—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)

1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase](#2-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-supabase)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Resend (Email)](#3-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-resend-email)
4. [–î–µ–ø–ª–æ–π –Ω–∞ Vercel](#4-–¥–µ–ø–ª–æ–π-–Ω–∞-vercel)
5. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π](#5-–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π-–¥–µ–ø–ª–æ–π)
6. [–û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#6-–æ—á–∏—Å—Ç–∫–∞-—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω)
cd ~/path/to/asia-pharm

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Supabase CLI
brew install supabase/tap/supabase

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é
supabase --version
```

---

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Supabase (–Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
3. –ù–∞–∂–º–∏—Ç–µ "New Project"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Name**: asia-pharm
   - **Database Password**: –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ!)
   - **Region**: Southeast Asia (Singapore) - –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω
5. –ù–∞–∂–º–∏—Ç–µ "Create new project"
6. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è

### 2.2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π Supabase

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Project Settings** ‚Üí **API**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ:
   - **Project URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://xxxxxx.supabase.co`)
   - **anon public** key (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ...`)
   - **service_role** key (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ...`) - **–°–ï–ö–†–ï–¢–ù–´–ô –ö–õ–Æ–ß!**

3. –û—Ç–∫—Ä–æ–π—Ç–µ **Project Settings** ‚Üí **Database**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - **Connection string** ‚Üí **URI** (–≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º Transaction)
   - –ë—É–¥–µ—Ç –≤–∏–¥–∞: `postgresql://postgres.xxxxx:[YOUR-PASSWORD]@...`

### 2.3. –õ–æ–≥–∏–Ω –≤ Supabase CLI

```bash
# 1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
supabase login

# –û—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
# –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–æ—Å—Ç—É–ø

# 2. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –∫ Supabase
supabase link --project-ref YOUR_PROJECT_REF

# YOUR_PROJECT_REF - —ç—Ç–æ ID –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ URL
# –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ https://boybkoyidxwrgsayifrd.supabase.co
# Project Ref = boybkoyidxwrgsayifrd
```

### 2.4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ SQL Editor –≤ Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ Supabase Dashboard
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π SQL:

```sql
-- ============================================
-- –ü–û–õ–ù–ê–Ø –°–•–ï–ú–ê –ë–ê–ó–´ –î–ê–ù–ù–´–• ASIA PHARM
-- ============================================

-- 1. –¢–ê–ë–õ–ò–¶–ê: products
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
CREATE TABLE IF NOT EXISTS products (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  name_en TEXT,
  name_zh TEXT,
  name_vi TEXT,
  short_description TEXT,
  description TEXT,
  price NUMERIC(10, 2) NOT NULL,
  image TEXT,
  category TEXT NOT NULL,
  disease TEXT,
  disease_categories TEXT[] DEFAULT ARRAY[]::TEXT[],
  store TEXT NOT NULL CHECK (store IN ('china', 'thailand', 'vietnam')),
  in_stock BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è products
CREATE INDEX IF NOT EXISTS idx_products_store ON products(store);
CREATE INDEX IF NOT EXISTS idx_products_category ON products(category);
CREATE INDEX IF NOT EXISTS idx_products_disease ON products(disease);
CREATE INDEX IF NOT EXISTS idx_products_disease_categories ON products USING GIN(disease_categories);

-- 2. –¢–ê–ë–õ–ò–¶–ê: categories
-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –Ω–∞ 4 —è–∑—ã–∫–∞
CREATE TABLE IF NOT EXISTS categories (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL CHECK (type IN ('top', 'side')),
  translations JSONB NOT NULL,
  icon TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- 3. –¢–ê–ë–õ–ò–¶–ê: orders
-- –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  store TEXT NOT NULL CHECK (store IN ('china', 'thailand', 'vietnam')),
  items JSONB NOT NULL,
  total NUMERIC(10, 2) NOT NULL,
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'completed', 'cancelled')),
  shipping_info JSONB NOT NULL,
  payment_method TEXT NOT NULL,
  promo_code TEXT,
  discount NUMERIC(10, 2) DEFAULT 0,
  shipping_cost NUMERIC(10, 2) DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è orders
CREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders(user_id);
CREATE INDEX IF NOT EXISTS idx_orders_store ON orders(store);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
CREATE INDEX IF NOT EXISTS idx_orders_created_at ON orders(created_at DESC);

-- 4. –¢–ê–ë–õ–ò–¶–ê: promo_codes
-- –ü—Ä–æ–º–æ–∫–æ–¥—ã
CREATE TABLE IF NOT EXISTS promo_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code TEXT UNIQUE NOT NULL,
  discount_type TEXT NOT NULL CHECK (discount_type IN ('percent', 'amount')),
  discount_value NUMERIC(10, 2) NOT NULL,
  usage_limit INTEGER,
  times_used INTEGER DEFAULT 0,
  valid_until TIMESTAMP WITH TIME ZONE,
  active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è promo_codes
CREATE INDEX IF NOT EXISTS idx_promo_codes_code ON promo_codes(code) WHERE active = true;

-- 5. –¢–ê–ë–õ–ò–¶–ê: user_profiles
-- –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–∞–ª–∞–Ω—Å–æ–º –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
CREATE TABLE IF NOT EXISTS user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  email TEXT NOT NULL,
  name TEXT,
  phone TEXT,
  loyalty_points INTEGER DEFAULT 0,
  total_spent NUMERIC(10, 2) DEFAULT 0,
  is_admin BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- 6. –¢–ê–ë–õ–ò–¶–ê: loyalty_transactions
-- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–∞–ª–ª–æ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
CREATE TABLE IF NOT EXISTS loyalty_transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  order_id UUID REFERENCES orders(id) ON DELETE SET NULL,
  points INTEGER NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('earned', 'spent', 'expired', 'bonus')),
  description TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è loyalty_transactions
CREATE INDEX IF NOT EXISTS idx_loyalty_transactions_user_id ON loyalty_transactions(user_id);
CREATE INDEX IF NOT EXISTS idx_loyalty_transactions_created_at ON loyalty_transactions(created_at DESC);

-- 7. –¢–ê–ë–õ–ò–¶–ê: newsletter_subscriptions
-- –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É
CREATE TABLE IF NOT EXISTS newsletter_subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  subscribed BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  unsubscribed_at TIMESTAMP WITH TIME ZONE
);

-- 8. –¢–ê–ë–õ–ò–¶–ê: user_preferences
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS user_preferences (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  language TEXT DEFAULT 'ru' CHECK (language IN ('ru', 'en', 'zh', 'vi')),
  currency TEXT DEFAULT 'RUB',
  email_notifications BOOLEAN DEFAULT true,
  sms_notifications BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- 9. –¢–ê–ë–õ–ò–¶–ê: kv_store_a75b5353
-- Key-Value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫, —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Ç.–¥.
CREATE TABLE IF NOT EXISTS kv_store_a75b5353 (
  key TEXT PRIMARY KEY,
  value JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è kv_store
CREATE INDEX IF NOT EXISTS idx_kv_store_updated_at ON kv_store_a75b5353(updated_at DESC);

-- 10. –¢–ê–ë–õ–ò–¶–ê: chat_messages
-- –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
CREATE TABLE IF NOT EXISTS chat_messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  message TEXT NOT NULL,
  sender TEXT NOT NULL CHECK (sender IN ('user', 'admin')),
  read BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è chat_messages
CREATE INDEX IF NOT EXISTS idx_chat_messages_user_id ON chat_messages(user_id);
CREATE INDEX IF NOT EXISTS idx_chat_messages_created_at ON chat_messages(created_at DESC);

-- ============================================
-- ROW LEVEL SECURITY (RLS) POLICIES
-- ============================================

-- –í–∫–ª—é—á–∞–µ–º RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
ALTER TABLE products ENABLE ROW LEVEL SECURITY;
ALTER TABLE categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE promo_codes ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE loyalty_transactions ENABLE ROW LEVEL SECURITY;
ALTER TABLE newsletter_subscriptions ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_preferences ENABLE ROW LEVEL SECURITY;
ALTER TABLE kv_store_a75b5353 ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_messages ENABLE ROW LEVEL SECURITY;

-- PRODUCTS: –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å
DROP POLICY IF EXISTS "Anyone can view products" ON products;
CREATE POLICY "Anyone can view products" ON products FOR SELECT USING (true);

DROP POLICY IF EXISTS "Service role can insert products" ON products;
CREATE POLICY "Service role can insert products" ON products FOR INSERT WITH CHECK (true);

DROP POLICY IF EXISTS "Service role can update products" ON products;
CREATE POLICY "Service role can update products" ON products FOR UPDATE USING (true);

DROP POLICY IF EXISTS "Service role can delete products" ON products;
CREATE POLICY "Service role can delete products" ON products FOR DELETE USING (true);

-- CATEGORIES: –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å
DROP POLICY IF EXISTS "Anyone can view categories" ON categories;
CREATE POLICY "Anyone can view categories" ON categories FOR SELECT USING (true);

DROP POLICY IF EXISTS "Service role can manage categories" ON categories;
CREATE POLICY "Service role can manage categories" ON categories FOR ALL USING (true);

-- ORDERS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã
DROP POLICY IF EXISTS "Users can view own orders" ON orders;
CREATE POLICY "Users can view own orders" ON orders FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "Service role can manage all orders" ON orders;
CREATE POLICY "Service role can manage all orders" ON orders FOR ALL USING (true);

-- PROMO_CODES: –í—Å–µ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ, —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –∏–∑–º–µ–Ω—è—é—Ç
DROP POLICY IF EXISTS "Anyone can view active promo codes" ON promo_codes;
CREATE POLICY "Anyone can view active promo codes" ON promo_codes FOR SELECT USING (active = true);

DROP POLICY IF EXISTS "Service role can manage promo codes" ON promo_codes;
CREATE POLICY "Service role can manage promo codes" ON promo_codes FOR ALL USING (true);

-- USER_PROFILES: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
DROP POLICY IF EXISTS "Users can view own profile" ON user_profiles;
CREATE POLICY "Users can view own profile" ON user_profiles FOR SELECT USING (auth.uid() = id);

DROP POLICY IF EXISTS "Users can update own profile" ON user_profiles;
CREATE POLICY "Users can update own profile" ON user_profiles FOR UPDATE USING (auth.uid() = id);

DROP POLICY IF EXISTS "Service role can manage all profiles" ON user_profiles;
CREATE POLICY "Service role can manage all profiles" ON user_profiles FOR ALL USING (true);

-- LOYALTY_TRANSACTIONS: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
DROP POLICY IF EXISTS "Users can view own loyalty transactions" ON loyalty_transactions;
CREATE POLICY "Users can view own loyalty transactions" ON loyalty_transactions FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "Service role can manage loyalty transactions" ON loyalty_transactions;
CREATE POLICY "Service role can manage loyalty transactions" ON loyalty_transactions FOR ALL USING (true);

-- NEWSLETTER: –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—Ç
DROP POLICY IF EXISTS "Service role can manage newsletter" ON newsletter_subscriptions;
CREATE POLICY "Service role can manage newsletter" ON newsletter_subscriptions FOR ALL USING (true);

-- USER_PREFERENCES: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç —Å–≤–æ–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
DROP POLICY IF EXISTS "Users can view own preferences" ON user_preferences;
CREATE POLICY "Users can view own preferences" ON user_preferences FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "Users can update own preferences" ON user_preferences;
CREATE POLICY "Users can update own preferences" ON user_preferences FOR UPDATE USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "Service role can manage preferences" ON user_preferences;
CREATE POLICY "Service role can manage preferences" ON user_preferences FOR ALL USING (true);

-- KV_STORE: –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å
DROP POLICY IF EXISTS "Service role can manage kv store" ON kv_store_a75b5353;
CREATE POLICY "Service role can manage kv store" ON kv_store_a75b5353 FOR ALL USING (true);

-- CHAT_MESSAGES: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
DROP POLICY IF EXISTS "Users can view own chat messages" ON chat_messages;
CREATE POLICY "Users can view own chat messages" ON chat_messages FOR SELECT USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "Users can send chat messages" ON chat_messages;
CREATE POLICY "Users can send chat messages" ON chat_messages FOR INSERT WITH CHECK (auth.uid() = user_id AND sender = 'user');

DROP POLICY IF EXISTS "Service role can manage all chat messages" ON chat_messages;
CREATE POLICY "Service role can manage all chat messages" ON chat_messages FOR ALL USING (true);

-- ============================================
-- –§–£–ù–ö–¶–ò–ò –ò –¢–†–ò–ì–ì–ï–†–´
-- ============================================

-- –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è updated_at
DROP TRIGGER IF EXISTS update_products_updated_at ON products;
CREATE TRIGGER update_products_updated_at BEFORE UPDATE ON products
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS update_orders_updated_at ON orders;
CREATE TRIGGER update_orders_updated_at BEFORE UPDATE ON orders
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS update_user_profiles_updated_at ON user_profiles;
CREATE TRIGGER update_user_profiles_updated_at BEFORE UPDATE ON user_profiles
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS update_user_preferences_updated_at ON user_preferences;
CREATE TRIGGER update_user_preferences_updated_at BEFORE UPDATE ON user_preferences
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS update_kv_store_updated_at ON kv_store_a75b5353;
CREATE TRIGGER update_kv_store_updated_at BEFORE UPDATE ON kv_store_a75b5353
  FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- ============================================
-- –ù–ê–ß–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï: –ö–ê–¢–ï–ì–û–†–ò–ò
-- ============================================

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
TRUNCATE TABLE categories;

-- –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤)
INSERT INTO categories (id, type, translations) VALUES
('ointments', 'top', '{"ru": "–ú–∞–∑–∏", "en": "Ointments & Balms", "zh": "ËçØËÜèÂíåÈ¶ôËÜè", "vi": "Thu·ªëc m·ª° & D·∫ßu b√¥i"}'),
('patches', 'top', '{"ru": "–ü–ª–∞—Å—Ç—ã—Ä–∏", "en": "Patches", "zh": "Ë¥¥ËÜè", "vi": "Mi·∫øng d√°n"}'),
('sprays', 'top', '{"ru": "–°–ø—Ä–µ–∏", "en": "Sprays", "zh": "Âñ∑ÈõæÂâÇ", "vi": "X·ªãt"}'),
('tea', 'top', '{"ru": "–ß–∞–π", "en": "Tea", "zh": "Ëå∂", "vi": "Tr√†"}'),
('elixirs', 'top', '{"ru": "–≠–ª–∏–∫—Å–∏—Ä—ã", "en": "Elixirs", "zh": "ËçØÈÖí", "vi": "Thu·ªëc b·ªï"}'),
('pills', 'top', '{"ru": "–ü–∏–ª—é–ª–∏", "en": "Pills", "zh": "‰∏∏ËçØ", "vi": "Vi√™n thu·ªëc"}'),
('cosmetics', 'top', '{"ru": "–ö–æ—Å–º–µ—Ç–∏–∫–∞", "en": "Cosmetics", "zh": "ÂåñÂ¶ÜÂìÅ", "vi": "M·ªπ ph·∫©m"}'),
('accessories', 'top', '{"ru": "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã", "en": "Accessories", "zh": "ÈÖç‰ª∂", "vi": "Ph·ª• ki·ªán"}'),
('samples', 'top', '{"ru": "–ü—Ä–æ–±–Ω–∏–∫–∏", "en": "Samples", "zh": "Ê†∑ÂìÅ", "vi": "M·∫´u th·ª≠"}');

-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π)
INSERT INTO categories (id, type, translations) VALUES
('popular', 'side', '{"ru": "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã", "en": "Popular Products", "zh": "ÁÉ≠Èó®‰∫ßÂìÅ", "vi": "S·∫£n ph·∫©m ph·ªï bi·∫øn"}'),
('all', 'side', '{"ru": "–í—Å–µ —Ç–æ–≤–∞—Ä—ã", "en": "All Products", "zh": "ÊâÄÊúâ‰∫ßÂìÅ", "vi": "T·∫•t c·∫£ s·∫£n ph·∫©m"}'),
('cold', 'side', '{"ru": "–ü—Ä–æ—Å—Ç—É–¥–∞", "en": "Cold & Flu", "zh": "ÊÑüÂÜí", "vi": "C·∫£m l·∫°nh"}'),
('digestive', 'side', '{"ru": "–ñ–ö–¢", "en": "Digestive System", "zh": "Ê∂àÂåñÁ≥ªÁªü", "vi": "Ti√™u h√≥a"}'),
('skin', 'side', '{"ru": "–ö–æ–∂–∞", "en": "Skin", "zh": "ÁöÆËÇ§", "vi": "Da"}'),
('joints', 'side', '{"ru": "–°—É—Å—Ç–∞–≤—ã", "en": "Joints", "zh": "ÂÖ≥ËäÇ", "vi": "Kh·ªõp"}'),
('heart', 'side', '{"ru": "–°–µ—Ä–¥—Ü–µ –∏ —Å–æ—Å—É–¥—ã", "en": "Heart & Blood Vessels", "zh": "ÂøÉËÑèÂíåË°ÄÁÆ°", "vi": "Tim m·∫°ch"}'),
('liverKidneys', 'side', '{"ru": "–ü–µ—á–µ–Ω—å –∏ –ø–æ—á–∫–∏", "en": "Liver & Kidneys", "zh": "ËÇùËÇæ", "vi": "Gan & Th·∫≠n"}'),
('nervous', 'side', '{"ru": "–ù–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞", "en": "Nervous System", "zh": "Á•ûÁªèÁ≥ªÁªü", "vi": "H·ªá th·∫ßn kinh"}'),
('womensHealth', 'side', '{"ru": "–ñ–µ–Ω—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ", "en": "Women''s Health", "zh": "Â•≥ÊÄßÂÅ•Â∫∑", "vi": "S·ª©c kh·ªèe ph·ª• n·ªØ"}'),
('mensHealth', 'side', '{"ru": "–ú—É–∂—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ", "en": "Men''s Health", "zh": "Áî∑ÊÄßÂÅ•Â∫∑", "vi": "S·ª©c kh·ªèe nam gi·ªõi"}'),
('forChildren', 'side', '{"ru": "–î–ª—è –¥–µ—Ç–µ–π", "en": "For Children", "zh": "ÂÑøÁ´•", "vi": "Cho tr·∫ª em"}'),
('vision', 'side', '{"ru": "–ó—Ä–µ–Ω–∏–µ", "en": "Vision", "zh": "ËßÜÂäõ", "vi": "Th·ªã l·ª±c"}'),
('hemorrhoids', 'side', '{"ru": "–ì–µ–º–æ—Ä—Ä–æ–π", "en": "Hemorrhoids", "zh": "ÁóîÁñÆ", "vi": "Trƒ©"}'),
('oncology', 'side', '{"ru": "–û–Ω–∫–æ–ª–æ–≥–∏—è", "en": "Oncology", "zh": "ËÇøÁò§Áßë", "vi": "Ung th∆∞"}'),
('thyroid', 'side', '{"ru": "–©–∏—Ç–æ–≤–∏–¥–Ω–∞—è –∂–µ–ª–µ–∑–∞", "en": "Thyroid", "zh": "Áî≤Áä∂ËÖ∫", "vi": "Tuy·∫øn gi√°p"}'),
('lungs', 'side', '{"ru": "–õ–µ–≥–∫–∏–µ", "en": "Lungs", "zh": "ËÇ∫ÈÉ®", "vi": "Ph·ªïi"}');

-- ============================================
-- –ì–û–¢–û–í–û!
-- ============================================

SELECT 'Database schema created successfully!' AS status;
```

4. –ù–∞–∂–º–∏—Ç–µ **Run** –∏–ª–∏ `Cmd+Enter`
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫

### 2.5. –î–µ–ø–ª–æ–π Edge Function

Edge Function –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/supabase/functions/make-server-a75b5353/`

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
cd ~/path/to/asia-pharm

# 2. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é
supabase functions deploy make-server-a75b5353

# –í—ã —É–≤–∏–¥–∏—Ç–µ:
# Deploying Function make-server-a75b5353...
# Function deployed successfully!
```

### 2.6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Edge Function

Edge Function —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á Resend –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email.

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ RESEND_API_KEY –¥–ª—è edge function
supabase secrets set RESEND_API_KEY=re_xxxxxxxxxxxxxxxxx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
supabase secrets list
```

### 2.7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Edge Function

```bash
# –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
curl https://YOUR_PROJECT_REF.supabase.co/functions/v1/make-server-a75b5353/

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
# {"status":"ok","message":"Asia Pharm Server is running"}

# –¢–µ—Å—Ç health check
curl https://YOUR_PROJECT_REF.supabase.co/functions/v1/make-server-a75b5353/test/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Resend (Email)

### 3.1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ Resend

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://resend.com
2. –ù–∞–∂–º–∏—Ç–µ "Sign Up" –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email

### 3.2. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ **API Keys** –≤ –º–µ–Ω—é —Å–ª–µ–≤–∞
2. –ù–∞–∂–º–∏—Ç–µ "Create API Key"
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **Name**: asia-pharm-production
   - **Permission**: Full Access (–∏–ª–∏ Sending access)
4. –ù–∞–∂–º–∏—Ç–µ "Create"
5. **–í–ê–ñ–ù–û**: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ API –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `re_`)
6. –í—ã —É–≤–∏–¥–∏—Ç–µ –µ–≥–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!

### 3.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞:

1. –í Resend –æ—Ç–∫—Ä–æ–π—Ç–µ **Domains**
2. –ù–∞–∂–º–∏—Ç–µ "Add Domain"
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `asia-pharm.com`)
4. –î–æ–±–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞–∂–µ—Ç Resend
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)

**–ï—Å–ª–∏ –¥–æ–º–µ–Ω–∞ –Ω–µ—Ç**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `onboarding@resend.dev` (–ª–∏–º–∏—Ç 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å)

### 3.4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞ –≤ Supabase

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç –¥–ª—è Edge Function
supabase secrets set RESEND_API_KEY=re_xxxxxxxxxxxxxxxxx
```

---

## 4. –î–µ–ø–ª–æ–π –Ω–∞ Vercel

### 4.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
git add .
git commit -m "Ready for production deployment"
git push origin main
```

### 4.2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Vercel

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://vercel.com
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ GitHub
3. –ù–∞–∂–º–∏—Ç–µ "Add New..." ‚Üí "Project"
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `asia-pharm`
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç Vite):
   - **Framework Preset**: Vite (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - **Root Directory**: `./` (–∫–æ—Ä–µ–Ω—å)
   - **Build Command**: `npm run build` (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - **Output Directory**: `dist` (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   
**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç `vite.config.ts` –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 4.3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **Environment Variables**

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# Supabase
VITE_SUPABASE_URL=https://YOUR_PROJECT_REF.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGc...  # anon public key

# –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ service_role key –≤ frontend!
```

**–í–ê–ñ–ù–û**: 
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `VITE_` –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Vite
- –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ `SUPABASE_SERVICE_ROLE_KEY` –≤ Vercel (—ç—Ç–æ —Å–µ–∫—Ä–µ—Ç –¥–ª—è backend)
- –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ `RESEND_API_KEY` –≤ Vercel (—ç—Ç–æ –¥–ª—è Edge Function)

### 4.4. –î–µ–ø–ª–æ–π

1. –ù–∞–∂–º–∏—Ç–µ "Deploy"
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏ (2-3 –º–∏–Ω—É—Ç—ã)
3. Vercel –ø–æ–∫–∞–∂–µ—Ç URL –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞: `https://asia-pharm.vercel.app`

### 4.5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –í Vercel –æ—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **Domains**
2. –ù–∞–∂–º–∏—Ç–µ "Add"
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `asia-pharm.com`)
4. –î–æ–±–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–æ–≤
5. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

### 5.1. GitHub Actions –¥–ª—è Edge Functions

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.github/workflows/deploy-edge-functions.yml`:

```yaml
name: Deploy Supabase Edge Functions

on:
  push:
    branches:
      - main
    paths:
      - 'supabase/functions/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Supabase CLI
        uses: supabase/setup-cli@v1
        with:
          version: latest
      
      - name: Deploy Edge Functions
        run: supabase functions deploy make-server-a75b5353
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          SUPABASE_PROJECT_ID: ${{ secrets.SUPABASE_PROJECT_ID }}
```

### 5.2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è GitHub Actions

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ access token –≤ Supabase
# Dashboard ‚Üí Account ‚Üí Access Tokens ‚Üí Generate New Token

# 2. –î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub
# Repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions

# –î–æ–±–∞–≤—å—Ç–µ:
# SUPABASE_ACCESS_TOKEN - —Ç–æ–∫–µ–Ω –∏–∑ —à–∞–≥–∞ 1
# SUPABASE_PROJECT_ID - –≤–∞—à project ref
```

### 5.3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π Vercel

Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ `main`:

1. Push –≤ `main` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π production
2. Push –≤ –¥—Ä—É–≥—É—é –≤–µ—Ç–∫—É ‚Üí preview deployment
3. Pull Request ‚Üí preview deployment —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è:
- **Vercel Dashboard** ‚Üí **Settings** ‚Üí **Git**
- –í–∫–ª—é—á–∏—Ç–µ "Automatically deploy..."

---

## 6. –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 6.1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∫–ª—é—á–µ–π

**–ù–ï –£–î–ê–õ–Ø–ô–¢–ï –ü–†–û–ï–ö–¢!** –ü—Ä–æ—Å—Ç–æ –æ—á–∏—Å—Ç–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—ã.

```sql
-- –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor –≤ Supabase
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π SQL:

-- 1. –û—Ç–∫–ª—é—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
SET session_replication_role = replica;

-- 2. –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–í–ù–ò–ú–ê–ù–ò–ï: –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!)
TRUNCATE TABLE chat_messages CASCADE;
TRUNCATE TABLE loyalty_transactions CASCADE;
TRUNCATE TABLE newsletter_subscriptions CASCADE;
TRUNCATE TABLE user_preferences CASCADE;
TRUNCATE TABLE orders CASCADE;
TRUNCATE TABLE promo_codes CASCADE;
TRUNCATE TABLE user_profiles CASCADE;
TRUNCATE TABLE products CASCADE;
TRUNCATE TABLE categories CASCADE;
TRUNCATE TABLE kv_store_a75b5353 CASCADE;

-- 3. –í–∫–ª—é—á–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –æ–±—Ä–∞—Ç–Ω–æ
SET session_replication_role = DEFAULT;

-- 4. –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
DROP TABLE IF EXISTS chat_messages CASCADE;
DROP TABLE IF EXISTS loyalty_transactions CASCADE;
DROP TABLE IF EXISTS newsletter_subscriptions CASCADE;
DROP TABLE IF EXISTS user_preferences CASCADE;
DROP TABLE IF EXISTS orders CASCADE;
DROP TABLE IF EXISTS promo_codes CASCADE;
DROP TABLE IF EXISTS user_profiles CASCADE;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS categories CASCADE;
DROP TABLE IF EXISTS kv_store_a75b5353 CASCADE;

-- 5. –£–¥–∞–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
DROP FUNCTION IF EXISTS update_updated_at_column() CASCADE;

SELECT 'Database cleaned! Now run the full schema SQL to recreate tables.' AS status;
```

### 6.2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π SQL –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ **2.4** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∑–∞–Ω–æ–≤–æ.

### 6.3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

–í–∞—à–∏ –∫–ª—é—á–∏ API —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- **Project URL** - –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- **API Keys** - –Ω–µ –º–µ–Ω—è—é—Ç—Å—è
- **Database Password** - –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- **Edge Functions** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- **Secrets** (RESEND_API_KEY) - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

---

## 7. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞

### 7.1. –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∞–π—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Å–∞–π—Ç
2. –ù–∞–∂–º–∏—Ç–µ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —Å email `admin@asia-pharm.com`
4. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí **Table Editor** ‚Üí `user_profiles`
5. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
6. –ò–∑–º–µ–Ω–∏—Ç–µ `is_admin` –Ω–∞ `true`
7. –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### 7.2. –ß–µ—Ä–µ–∑ SQL

```sql
-- –ù–∞–π–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT id, email FROM auth.users WHERE email = 'admin@asia-pharm.com';

-- –°–¥–µ–ª–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞–¥–º–∏–Ω–æ–º
UPDATE user_profiles 
SET is_admin = true 
WHERE email = 'admin@asia-pharm.com';

-- –ü—Ä–æ–≤–µ—Ä–∫–∞
SELECT * FROM user_profiles WHERE is_admin = true;
```

---

## 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 8.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Å–∞–π—Ç –Ω–∞ Vercel
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   - ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
   - ‚úÖ –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ –ë–î)

### 8.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Edge Function

```bash
# Health check
curl https://YOUR_PROJECT_REF.supabase.co/functions/v1/make-server-a75b5353/

# –¢–µ—Å—Ç –ë–î
curl https://YOUR_PROJECT_REF.supabase.co/functions/v1/make-server-a75b5353/test/db
```

### 8.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Email (Resend)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏—à–ª–æ welcome email
3. –°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏—à–ª–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

---

## 9. –†–µ—à–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Edge Function –µ—Å—Ç—å CORS middleware:

```typescript
app.use('*', cors({
  origin: '*',
  allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
}));
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Service role key not found"

**–†–µ—à–µ–Ω–∏–µ**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ service_role key –≤–æ frontend! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ anon key.

### –ü—Ä–æ–±–ª–µ–º–∞: Email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ RESEND_API_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Edge Function secrets
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã Resend (100 –ø–∏—Å–µ–º/–¥–µ–Ω—å –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function –≤ Supabase Dashboard

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ RLS policies —Å–æ–∑–¥–∞–Ω—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ connection string
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π anon key

---

## 10. –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –°–±–æ—Ä–∫–∞ production
npm run build

# –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä production —Å–±–æ—Ä–∫–∏
npm run preview

# –î–µ–ø–ª–æ–π Edge Function
supabase functions deploy make-server-a75b5353

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Edge Function
supabase functions logs make-server-a75b5353

# –°–ø–∏—Å–æ–∫ —Å–µ–∫—Ä–µ—Ç–æ–≤
supabase secrets list

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–∞
supabase secrets set KEY=value

# –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
supabase secrets unset KEY
```

---

## 11. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

- [ ] –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ Supabase
- [ ] RLS policies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Edge Function –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞
- [ ] RESEND_API_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ secrets
- [ ] –ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ Vercel
- [ ] Environment variables –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Vercel
- [ ] –ü–µ—Ä–≤—ã–π –∞–¥–º–∏–Ω —Å–æ–∑–¥–∞–Ω
- [ ] –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –ë–î
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] Email –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–∫–∞–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞

---

## 12. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ Vercel
**Vercel Dashboard** ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí **Deployments** ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ø–ª–æ–π ‚Üí **View Function Logs**

### –õ–æ–≥–∏ Supabase
**Supabase Dashboard** ‚Üí **Logs** ‚Üí **Edge Functions**

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**Supabase Dashboard** ‚Üí **Table Editor** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–í–∞—à —Å–∞–π—Ç Asia Pharm —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!

**Production URLs:**
- Frontend: `https://asia-pharm.vercel.app` (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
- Edge Function: `https://YOUR_PROJECT_REF.supabase.co/functions/v1/make-server-a75b5353/`
- Supabase Dashboard: `https://supabase.com/dashboard/project/YOUR_PROJECT_REF`

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–û –Ω–∞—Å, –î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Ç.–¥.)
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ email —à–∞–±–ª–æ–Ω—ã
5. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (Google Analytics)

**–ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
- üìù **[QUICK_COMMANDS.md](./QUICK_COMMANDS.md)** - –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–µ–ø–ª–æ—è
- üìñ **[README.md](./README.md)** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- üóÑÔ∏è **SQL Scripts** - –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –≤—ã—à–µ (—Ä–∞–∑–¥–µ–ª 2.4 –∏ 6.1)

–£–¥–∞—á–∏! üöÄ
